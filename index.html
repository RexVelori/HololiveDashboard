<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>VTuber Stream Dashboard</title>
  <style>
    *{margin:0;padding:0;box-sizing:border-box}
    body{font-family:'Arial',sans-serif;background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);min-height:100vh;padding:20px}
    .dashboard{max-width:1200px;margin:0 auto}
    .header{text-align:center;margin-bottom:30px;color:white}
    .header h1{font-size:2.5rem;margin-bottom:10px;text-shadow:2px 2px 4px rgba(0,0,0,0.3)}
    .controls{background:rgba(255,255,255,0.1);backdrop-filter:blur(10px);border-radius:15px;padding:20px;margin-bottom:30px;border:1px solid rgba(255,255,255,0.2)}
    .channel-list{display:flex;flex-wrap:wrap;gap:10px;margin-top:15px}
    .channel-tag{background:rgba(255,255,255,0.2);color:white;padding:8px 12px;border-radius:20px;font-size:.9rem;display:flex;align-items:center;gap:8px;transition:all .3s ease}
    .toggle-btn{background:#2196F3;color:white;padding:8px 15px;font-size:12px;border:none;border-radius:8px;cursor:pointer;font-weight:bold;transition:all .3s ease}
    .toggle-btn:hover{background:#1976D2}
    .hololive-section{margin-top:10px}
    .generation-group{margin-bottom:20px;background:rgba(255,255,255,0.05);border-radius:10px;padding:15px}
    .generation-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:10px}
    .generation-header h4{color:white;font-size:1.1rem;margin:0}
    .member-buttons{display:flex;flex-wrap:wrap;gap:8px}
    .member-buttons button{background:rgba(255,255,255,0.1);color:white;border:1px solid rgba(255,255,255,0.3);padding:8px 12px;border-radius:20px;font-size:.85rem;transition:all .3s ease;cursor:pointer}
    .member-buttons button:hover{background:rgba(255,255,255,0.2);transform:translateY(-1px)}
    .member-buttons button.active{background:#4CAF50;border-color:#4CAF50}
    .channels-container{display:grid;grid-template-columns:repeat(auto-fit,minmax(350px,1fr));gap:20px}
    .channel-card{background:rgba(255,255,255,0.1);backdrop-filter:blur(10px);border-radius:15px;padding:20px;border:1px solid rgba(255,255,255,0.2);transition:transform .3s ease}
    .channel-card:hover{transform:translateY(-5px)}
    .channel-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:15px;padding-bottom:10px;border-bottom:1px solid rgba(255,255,255,0.2)}
    .channel-name{color:white;font-size:1.2rem;font-weight:bold}
    .video-item{background:rgba(255,255,255,0.05);border-radius:8px;padding:15px;margin-bottom:15px;border-left:4px solid #4CAF50;transition:all .3s ease;display:flex;gap:12px;align-items:flex-start;cursor:pointer}
    .video-item:hover{background:rgba(255,255,255,0.1);transform:translateX(5px)}
    .video-thumbnail{width:120px;height:68px;border-radius:6px;object-fit:cover;flex-shrink:0}
    .video-content{flex:1;min-width:0}
    .video-title{color:white;font-weight:bold;margin-bottom:5px;line-height:1.3;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden}
    .video-meta{color:rgba(255,255,255,0.7);font-size:.9rem}
    .loading,.empty-state{text-align:center;color:rgba(255,255,255,0.7);padding:40px}
    .error{background:rgba(244,67,54,0.1);border:1px solid rgba(244,67,54,0.3);color:#ffcdd2;padding:15px;border-radius:8px;margin-bottom:15px}
  </style>
</head>
<body>
  <div class="dashboard">
    <div class="header">
      <h1>ðŸŽ¬ VTuber Stream Dashboard</h1>
      <p>All recent uploads (no filtering)</p>
    </div>

    <div class="controls">
      <div id="hololiveSection" class="hololive-section"></div>
      <div class="channel-list" id="channelList"></div>
    </div>

    <div id="channelsContainer" class="channels-container">
      <div class="empty-state">
        <h3>No channels active</h3>
        <p>Toggle a generation or a member to load their latest videos.</p>
      </div>
    </div>
  </div>

  <script>
    // =========================
    // CONFIG â€” edit here
    // =========================
    const CONFIG = {
      defaultActive: false, // set true to preload everything
      groups: [
        {
          key: 'myth', label: 'Myth',
          members: [
            { id:'UCL_qhgtOy0dy1Agp8vkySQg', name:'Mori Calliope Ch.' },
            { id:'UCMwGHR0BTZuLsmjY_NT5Pwg', name:"Ninomae Ina'nis Ch." },
            { id:'UCHsx4Hqa-1ORjQTh9TYDhww', name:'Takanashi Kiara Ch.' },
          ]
        },
        {
          key: 'promise', label: 'Promise',
          members: [
            { id:'UCmbs8T6MWqUHP1tIQvSgKrg', name:'Ouro Kronii Ch.' },
            { id:'UCgmPnx-EEeOrZSg5Tiw7ZRQ', name:'Hakos Baelz Ch.' },
            { id:'UC8rcEBzJSleTkf_-agPM20g', name:'IRyS Ch.' }
          ]
        },
        {
          key: 'advent', label: 'Advent',
          members: [
            { id:'UCgnfPPb9JI3e9A4cXHnWbyg', name:'Shiori Novella Ch.' },
            { id:'UC9p_lqQ0FEDz327Vgf5JwqA', name:'Koseki Bijou Ch.' },
            { id:'UC_sFNM0z0MWm9A6WlKPuMMg', name:'Nerissa Ravencroft Ch.' },
            { id:'UCt9H_RpQzhxzlyBxFqrdHqA', name:'FUWAMOCO Ch.' }
          ]
        },
        {
          key: 'justice', label: 'Justice',
          members: [
            { id:'UCW5uhrG1eCBYditmhL0Ykjw', name:'Elizabeth Rose Bloodflame Ch.' },
            { id:'UCDHABijvPBnJm7F-KlNME3w', name:'Gigi Murin Ch.' },
            { id:'UCvN5h1ShZtc7nly3pezRayg', name:'Cecilia Immergreen Ch.' },
            { id:'UCl69AEx4MdqMZH7Jtsm7Tig', name:'Raora Panthera Ch.' }
          ]
        },
        {
            key: 'indie', label: 'Indie',
            members: [
                {id: 'UCxsZ6NCzjU_t4YSxQLBcM5A', name: 'saba'},
                {id: 'UCcHHkJ98eSfa5aj0mdTwwLQ', name: 'Maid Mint Ch.'}
            ]
        }
      ]
    };

    // =========================
    // State
    // =========================
    let channels = [];
    let channelData = {};

    const hololiveMembers = Object.fromEntries(
      CONFIG.groups.flatMap(g => g.members.map(m => [m.id, m.name]))
    );
    const generations = Object.fromEntries(
      CONFIG.groups.map(g => [g.key, g.members.map(m => m.id)])
    );

    CONFIG.groups.forEach(g => g.members.forEach(m => {
      channels.push({ id: m.id, name: m.name, active: !!CONFIG.defaultActive });
    }));

    // =========================
    // UI
    // =========================
    function escapeHtml(str){
      return str.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');
    }

    function renderHololiveUI(){
      const root = document.getElementById('hololiveSection');
      root.innerHTML = CONFIG.groups.map(group => `
        <div class="generation-group" id="group-${group.key}">
          <div class="generation-header">
            <h4>${group.label}</h4>
            <button id="toggle-${group.key}" class="toggle-btn" onclick="toggleGeneration('${group.key}')">
              ${CONFIG.defaultActive ? 'Hide All' : 'Show All'}
            </button>
          </div>
          <div class="member-buttons" id="${group.key}-members">
            ${group.members.map(m => `
              <button data-channel-id="${m.id}" onclick="toggleMember('${m.id}')">${escapeHtml(m.name.replace(' Ch.',''))}</button>
            `).join('')}
          </div>
        </div>
      `).join('');
      updateMemberButtons();
    }

    function updateMemberButtons(){
      CONFIG.groups.forEach(group => {
        const buttons = document.querySelectorAll(`#${group.key}-members button`);
        buttons.forEach(btn => {
          const id = btn.getAttribute('data-channel-id');
          const ch = channels.find(c => c.id === id);
          btn.classList.toggle('active', !!(ch && ch.active));
        });

        const genButton = document.getElementById(`toggle-${group.key}`);
        const ids = generations[group.key];
        const activeCount = ids.filter(id => {
          const ch = channels.find(c => c.id === id);
          return ch && ch.active;
        }).length;

        if (activeCount === ids.length) genButton.textContent = 'Hide All';
        else if (activeCount === 0)    genButton.textContent = 'Show All';
        else                           genButton.textContent = `Show All (${activeCount}/${ids.length})`;
      });

      updateChannelList();
    }

    function updateChannelList(){
      const list = document.getElementById('channelList');
      const activeOnes = channels.filter(c => c.active);
    }

    // =========================
    // Toggles
    // =========================
    function toggleMember(channelId){
      const existing = channels.find(c => c.id === channelId);
      if (existing){
        existing.active = !existing.active;
      }else{
        channels.push({ id: channelId, name: hololiveMembers[channelId] || ('Channel '+channelId), active: true });
      }
      updateMemberButtons();
      renderChannels();
      if (!channelData[channelId]) fetchChannelData(channelId);
    }

    function toggleGeneration(generationName){
      const ids = generations[generationName];
      const hasInactive = ids.some(id => {
        const ch = channels.find(c => c.id === id);
        return !ch || !ch.active;
      });

      if (hasInactive){
        ids.forEach(id => {
          const existing = channels.find(c => c.id === id);
          if (existing){ existing.active = true; }
          else { channels.push({ id, name: hololiveMembers[id] || ('Channel '+id), active: true }); }
          if (!channelData[id]) fetchChannelData(id);
        });
      }else{
        ids.forEach(id => {
          const ch = channels.find(c => c.id === id);
          if (ch) ch.active = false;
        });
      }
      updateMemberButtons();
      renderChannels();
    }

    function toggleChannel(channelId){
      const ch = channels.find(c => c.id === channelId);
      if (ch){
        ch.active = !ch.active;
        updateMemberButtons();
        renderChannels();
      }
    }

    // =========================
    // Data (RSS-only, no filtering)
    // =========================
    async function fetchChannelData(channelId){
      try{
        channelData[channelId] = { loading:true, error:null, name: hololiveMembers[channelId] || ('Channel '+channelId), videos: [] };
        renderChannels();

        const rssUrl = `https://www.youtube.com/feeds/videos.xml?channel_id=${channelId}`;
        const proxyUrl = `https://corsproxy.io/?${encodeURIComponent(rssUrl)}`;
        const res = await fetch(proxyUrl);
        if (!res.ok) throw new Error('Failed to fetch RSS feed. CORS restrictions may be blocking the request.');

        const xml = await res.text();
        const doc = new DOMParser().parseFromString(xml,'text/xml');
        if (doc.querySelector('parsererror')) throw new Error('Invalid RSS feed format');

        const channelTitle = doc.querySelector('feed > title')?.textContent || `Channel ${channelId}`;
        
        const entries = Array.from(doc.querySelectorAll('entry'));

        const videos = entries.map(entry => {
        const link = entry.querySelector('link')?.getAttribute('href') || '';
        if (link.includes('/shorts/')) return null; // ðŸš« ignore Shorts

        const title = entry.querySelector('title')?.textContent || 'No title';
        const published = entry.querySelector('published')?.textContent || '';
        const videoId = entry.querySelector('yt\\:videoId, videoId')?.textContent || '';
        const thumbnail = videoId ? `https://img.youtube.com/vi/${videoId}/mqdefault.jpg` : '';

        return { title, publishedAt: published, videoId, link, thumbnail };
        }).filter(Boolean);

        channelData[channelId] = { name: channelTitle, videos, loading:false, error:null };
      }catch(err){
        console.error(err);
        channelData[channelId] = { name: hololiveMembers[channelId] || `Channel ${channelId}`, videos: [], loading:false, error:String(err.message||err) };
      }
      renderChannels();
    }

    // =========================
    // Render
    // =========================
    function renderChannels(){
      const container = document.getElementById('channelsContainer');
      const active = channels.filter(c => c.active);
      if (active.length === 0){
        container.innerHTML = "";
        return;
      }

      container.innerHTML = active.map(ch => {
        const data = channelData[ch.id];
        if (!data || data.loading){
          return `
            <div class="channel-card">
              <div class="channel-header"><div class="channel-name">${escapeHtml(ch.name)}</div></div>
              <div class="loading">Loading videosâ€¦</div>
            </div>`;
        }
        if (data.error){
          return `
            <div class="channel-card">
              <div class="channel-header"><div class="channel-name">${escapeHtml(data.name)}</div></div>
              <div class="error">${escapeHtml(data.error)}</div>
            </div>`;
        }
        if (!data.videos.length){
          return `
            <div class="channel-card">
              <div class="channel-header"><div class="channel-name">${escapeHtml(data.name)}</div></div>
              <div class="empty-state">No recent uploads found.</div>
            </div>`;
        }

        return `
          <div class="channel-card">
            <div class="channel-header"><div class="channel-name">${escapeHtml(data.name)}</div></div>
            ${data.videos.map(v => `
              <div class="video-item" onclick="openVideo('${v.link}')">
                <img src="${v.thumbnail}" alt="Video thumbnail" class="video-thumbnail" onerror="this.style.display='none'"/>
                <div class="video-content">
                  <div class="video-title">${escapeHtml(v.title)}</div>
                  <div class="video-meta">${formatDate(v.publishedAt)}</div>
                </div>
              </div>`).join('')}
          </div>`;
      }).join('');
    }

    function openVideo(link){ window.open(link, '_blank'); }

    function formatDate(dateString){
      const date = new Date(dateString);
      const now = new Date();
      const diffTime = Math.abs(now - date);
      const diffDays = Math.floor(diffTime / (1000*60*60*24));
      if (diffDays===0) return 'Today';
      if (diffDays===1) return 'Yesterday';
      if (diffDays<7)  return `${diffDays} days ago`;
      return date.toLocaleDateString();
    }

    // Boot
    renderHololiveUI();
    if (CONFIG.defaultActive){
      channels.filter(c=>c.active).forEach(c => fetchChannelData(c.id));
    }
    renderChannels();
  </script>
</body>
</html>
